<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Intro to nimbleEcology: site-occupancy models</title>

  <meta property="description" itemprop="description" content="An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-01-31"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-01-31"/>
  <meta name="article:author" content="Ben R Goldstein"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Intro to nimbleEcology: site-occupancy models"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Intro to nimbleEcology: site-occupancy models"/>
  <meta property="twitter:description" content="An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","editor_options"]}},"value":[{"type":"character","attributes":{},"value":["Intro to nimbleEcology: site-occupancy models"]},{"type":"character","attributes":{},"value":["An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Ben R Goldstein"]}]}]},{"type":"character","attributes":{},"value":["2022-01-31"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["markdown"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["wrap"]}},"value":[{"type":"integer","attributes":{},"value":[72]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["images/swift.png","intro-to-nimbleecology-site-occupancy-models_files/anchor-4.2.2/anchor.min.js","intro-to-nimbleecology-site-occupancy-models_files/bowser-1.9.3/bowser.min.js","intro-to-nimbleecology-site-occupancy-models_files/distill-2.2.21/template.v2.js","intro-to-nimbleecology-site-occupancy-models_files/figure-html5/unnamed-chunk-13-1.png","intro-to-nimbleecology-site-occupancy-models_files/header-attrs-2.11.15/header-attrs.js","intro-to-nimbleecology-site-occupancy-models_files/jquery-3.6.0/jquery-3.6.0.js","intro-to-nimbleecology-site-occupancy-models_files/jquery-3.6.0/jquery-3.6.0.min.js","intro-to-nimbleecology-site-occupancy-models_files/jquery-3.6.0/jquery-3.6.0.min.map","intro-to-nimbleecology-site-occupancy-models_files/popper-2.6.0/popper.min.js","intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy-bundle.umd.min.js","intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy-light-border.css","intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy.css","intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy.umd.min.js","intro-to-nimbleecology-site-occupancy-models_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="intro-to-nimbleecology-site-occupancy-models_files/header-attrs-2.11.15/header-attrs.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/popper-2.6.0/popper.min.js"></script>
  <link href="intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="intro-to-nimbleecology-site-occupancy-models_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="intro-to-nimbleecology-site-occupancy-models_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Intro to nimbleEcology: site-occupancy models","description":"An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework.","authors":[{"author":"Ben R Goldstein","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-01-31T00:00:00.000-08:00","citationText":"Goldstein, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Intro to nimbleEcology: site-occupancy models</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>An introductory guide to estimating site-occupancy models in a Bayesian or maximum likelihood framework.</p></p>
</div>

<div class="d-byline">
  Ben R Goldstein  
  
<br/>2022-01-31
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#overiview-of-the-site-occupancy-model">Overiview of the site-occupancy model</a>
<ul>
<li><a href="#structure">Structure</a></li>
</ul></li>
<li><a href="#what-is-nimbleecology">What is nimbleEcology?</a>
<ul>
<li><a href="#why-should-i-use-it">Why should I use it?</a></li>
</ul></li>
<li><a href="#implementing-the-occupancy-model-with-nimbleecology">Implementing the occupancy model with nimbleEcology</a></li>
<li><a href="#next-time">Next time…</a></li>
<li><a href="#citations-and-additional-reading">Citations and additional reading</a></li>
</ul>
</nav>
</div>
<h1 id="overiview-of-the-site-occupancy-model">Overiview of the site-occupancy model</h1>
<p><em>If you’re here for the nimbleEcology implementation, and feel comfortable with occupancy models, you can skip ahead to the next section.</em></p>
<p>In species distribuiton modeling, we’re often interested in whether animals’ presence on the landscape is influenced by or correlated with a spatiotemporal factor. For example, we might be interested in whether a species prefers dense or sparse tree cover, whether a species’ range is growing or declining over time, or whether a management strategy is actually working to</p>
<p>Site-occupancy models are a type of statistical structure that allow us to ask these questions when our detection process is imperfect.</p>
<h3 id="structure">Structure</h3>
<p>Let’s start by putting down some statistical equations for the simplest hierarchical site-occupancy model.</p>
<p><span class="math display">\[y_{ij} \sim \text{Bernoulli}(z_i * p_{ij})\]</span> <span class="math display">\[z_i \sim \text{Bernoulli}(\psi_i)\]</span> <span class="math display">\[\text{logit}(\psi_{i}) = x_{i}^T\beta\]</span> <span class="math display">\[\text{logit}(p_{ij}) = w_{ij}^T\gamma\]</span></p>
<p>where <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> index site and replicate visit, respectively; <span class="math inline">\(y_{ij}\)</span> is a single detection or nondetection (1 or 0) at site <span class="math inline">\(i\)</span>, replicate <span class="math inline">\(j\)</span>; <span class="math inline">\(z_i\)</span> is a latent state representing occupancy; <span class="math inline">\(\psi_i\)</span> is the probability that site <span class="math inline">\(i\)</span> is occupied; <span class="math inline">\(p_{ij}\)</span> is an observation-specific conditional detection probability; <span class="math inline">\(x_i\)</span> and <span class="math inline">\(w_{ij}\)</span> are vectors of covariates of interest; and <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> are vectors of coefficients representing the effect of covariates on occupancy and detection, respectively.</p>
<p>Phew. Let’s break that down.</p>
<p>In the <strong>first equation</strong>, we describe the probability distribution for our detection-nondetection observations, <span class="math inline">\(y_{ij}\)</span>. We say that each data point is Bernoulli-distributed: we have a probability of <span class="math inline">\(z_i * p_{ij}\)</span> of seeing the animal. Since we either see it or we don’t, the probability of not seeing the animal is <span class="math inline">\(1 - z_i * p_{ij}\)</span>.</p>
<p>In the occupancy model, we assume that each “site” is in fact occupied or unoccupied, but that we can’t observe this condition perfectly. (I put “site” in quotation marks because the “site” need not be strictly spatial–for example, we could treat the occupancy status of a single location in different years as independent. Because the assumption that occupancy status doesn’t change is called “closure,” we can also call this unit a “unit of closure.”) In our <strong>second equation</strong>, we represent this with the latent state <span class="math inline">\(z_i\)</span>, which has a value of 1 if site <span class="math inline">\(i\)</span> is occupied and 0 if it is not. If the site is unoccupied, we have no chance of seeing the animal. In that case, <span class="math inline">\(z_i = 0\)</span> and the probability of <span class="math inline">\(y_ij = 1\)</span> is also 0. Think of <span class="math inline">\(z_i\)</span> as a switch that turns the probability of seeing the animal on or off. The “conditional probability of detection,” i.e. the probability that we see the animal when it’s present on a given observation, is <span class="math inline">\(p_ij\)</span>. It’s conditional because it only affects the data likelihood when <span class="math inline">\(z_i =1\)</span>. In the second equation, we define the distribution for the latent state <span class="math inline">\(z_i\)</span>, which has a probability of <span class="math inline">\(\psi_i\)</span>.</p>
<p>The <strong>third equation</strong> links our probability of occupancy, <span class="math inline">\(\psi_i\)</span>, to covariates. We say that, on the logit scale (which is a popular but arbitrary transformation from <span class="math inline">\((-\infty, \infty)\)</span> to <span class="math inline">\((0, 1)\)</span>), <span class="math inline">\(\psi_i\)</span> is a linear combination of some observed data describing our site, <span class="math inline">\(x_{i}\)</span>, with coefficients <span class="math inline">\(\beta\)</span>. We want to estimate <span class="math inline">\(\beta\)</span> to get confidence or credible intervals on those effects.</p>
<p>The <strong>fourth equation</strong> replicates this logit-link structure for our detection probability, <span class="math inline">\(p\)</span>, and some covariates <span class="math inline">\(w\)</span> with coefficients <span class="math inline">\(\gamma\)</span>.</p>
<p>There are many other, much more comprehensive explanations of the occupancy model out there, including entire textbooks. I link some of these at the end of the post.</p>
<h1 id="what-is-nimbleecology">What is nimbleEcology?</h1>
<p>nimbleEcology is an R package that makes it easier to implement some common ecological models in the general statistical software NIMBLE.</p>
<p>The package provides a series of distributions that you can use in NIMBLE models, similar to familiar distributions like <code>dpois()</code> or <code>dbinom()</code>. This will become clear with the example in this blog post, where I show how the entire occupancy hierarchical probability distribution for the occupancy model can be written with <code>y ~ dOcc_v(...)</code>.</p>
<h3 id="why-should-i-use-it">Why should I use it?</h3>
<ul>
<li><strong>Less risk of coding errors</strong>. We went ahead and implemented the occupancy distribution so you don’t have to. This saves lines of code and hopefully reduces some of the headache that inevitably comes from debugging a new model.</li>
<li><strong>It’s easily modifiable</strong>. Implementing models in nimbleEcology, compared to something like unmarked, makes it easier to modify and customize your model when you’re ready to get fancy.</li>
<li><strong>It’s fairly efficient</strong>. nimbleEcology uses marginalized distributions, saving memory and sometimes (but not always) increasing computational efficiency.</li>
<li><strong>Swap between MLE or Bayesian methodology</strong>. This maybe isn’t a <em>need</em> so much as an interesting feature, but with NIMBLE you have access to both maximum likelihood and Bayesian (MCMC) estimation with very few changes to the model code.</li>
</ul>
<h1 id="implementing-the-occupancy-model-with-nimbleecology">Implementing the occupancy model with nimbleEcology</h1>
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span style="display:block;" id="fig:swift"></span>
<img src="images/swift.png" alt="Swift (c) J Tanner 2022. &lt;https://macaulaylibrary.org/asset/409111121&gt;" width="100%" data-distill-preview=1 />
<p class="caption">
Figure 1: Swift (c) J Tanner 2022. <a href="https://macaulaylibrary.org/asset/409111121" class="uri">https://macaulaylibrary.org/asset/409111121</a>
</p>
</div>
</div>
<!-- ![Swift photo (c) J Tanner 2022. -->
<!-- <https://macaulaylibrary.org/asset/409111121>](images/swift.png) -->
<p>In this section, I showcase the use of nimbleEcology for implementing an occupancy model with simulated data.</p>
<p>Let’s say we have some data we collected in a study on how the occupancy of a bird, the white-throated swift. I have my detection/nondetection data in a matrix called “obs”. We surveyed 200 sites three times each, and recorded whether or not we observed swifts during those surveys.</p>
<p>Here are the first six rows in the data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     [,1] [,2] [,3]
[1,]    0    0    0
[2,]    0    0    0
[3,]    1    1    0
[4,]    0    0    1
[5,]    1    0    1
[6,]    0    0    0</code></pre>
</div>
<p>We detected the swift at four of the first six sites. Here are a few more summary statistics:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Total number of sites with detections ("naive occupancy")</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 69</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Average number of observations per occupied site</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, <span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 0.4879227</code></pre>
</div>
<p>We want to know how the elevation and amount of forest cover impact the occupancy of our swifts in the study area. We measured elevation and forest cover at each of our sites. Here’s the first six sites’ data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>siteLevelData</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>   elevation forestCover
1 -0.9559221  0.37841493
2 -0.9790799 -0.01406795
3  0.4368064  0.17601854
4 -0.7193709 -0.92947860
5 -0.2721558 -0.43107788
6  0.0428613  0.49594396</code></pre>
</div>
<p>(In the previous section, each row of these data are an <span class="math inline">\(x_i\)</span>.)</p>
<p>We’re using an occupancy model because we think our data contains false negatives–i.e., sometimes we didn’t see a swift at an occupied site. We think that sometimes, high wind conditions could reduce our ability to see swifts. And we also don’t want to rule out the possibility that detection probabilities vary with elevation or tree cover. Disambiguating the effects of a single variable on <strong>both</strong> detection and probability is one of the main benefits of th occupancy model.</p>
<p>Here’s data from the first six sites for our three detection variables.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>obsLevelData</span><span class='op'>[</span>,,<span class='st'>"elevation"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>           [,1]       [,2]       [,3]
[1,] -0.9559221 -0.9559221 -0.9559221
[2,] -0.9790799 -0.9790799 -0.9790799
[3,]  0.4368064  0.4368064  0.4368064
[4,] -0.7193709 -0.7193709 -0.7193709
[5,] -0.2721558 -0.2721558 -0.2721558
[6,]  0.0428613  0.0428613  0.0428613</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>obsLevelData</span><span class='op'>[</span>,,<span class='st'>"forestCover"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>            [,1]        [,2]        [,3]
[1,]  0.37841493  0.37841493  0.37841493
[2,] -0.01406795 -0.01406795 -0.01406795
[3,]  0.17601854  0.17601854  0.17601854
[4,] -0.92947860 -0.92947860 -0.92947860
[5,] -0.43107788 -0.43107788 -0.43107788
[6,]  0.49594396  0.49594396  0.49594396</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>obsLevelData</span><span class='op'>[</span>,,<span class='st'>"windLevel"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>          [,1]       [,2]       [,3]
[1,] 0.5818751  0.6126206 -0.7922553
[2,] 0.2276861  0.7952973 -0.6619532
[3,] 0.9545355 -0.6955473 -0.6014542
[4,] 0.8137390  0.4535272  0.6110631
[5,] 0.5897824 -0.3132945  0.1687786
[6,] 0.3905541  0.3720862 -0.2839954</code></pre>
</div>
<p>For the sake of simplicity, we’ll assume that our sites are random and representative of the study area, that we have good reason to believe we aren’t recording false positive observations, and that we don’t think our detection process is variable except due to the factors we’re considering (wind, forest cover, and elevation).</p>
<p>Let’s get to modeling!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-nimble.org'>nimble</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/nimble-dev/nimbleEcology'>nimbleEcology</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>First, to use NIMBLE, we’re going to define a <code>nimbleCode</code> object. This code object uses a pseudo-code language, blending .</p>
<p>NIMBLE uses a declarative language, meaning order doesn’t matter. A consequence of this is that you can’t overwrite values. Instead of stepping through lines of code, think of <code>nimbleCode</code> as defining relationships between variables (nodes).</p>
<p>For a more in-depth overview of the NIMBLE code language</p>
<p>Ok, enough stalling. Here’s the NIMBLE code for our model, with comments.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>occuCode</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimbleCode.html'>nimbleCode</a></span><span class='op'>(</span><span class='op'>{</span>
  <span class='co'># Loop over sites</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>site</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nSites</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='co'># Here's the nimbleEcology magic: the dOcc_* distribution.</span>
    <span class='co'># This line of code says that our observations follow a probability</span>
    <span class='co'>#   distribution in the occupancy model, with a single occupancy probability</span>
    <span class='co'>#   and a vector of detection probabilities corresponding to each </span>
    <span class='co'>#   observation. Note that we wass a whole site's worth of data at once.</span>
    <span class='co'># Try running ?nimbleEcology::dOcc in your R session for more info.</span>
    <span class='va'>obs</span><span class='op'>[</span><span class='va'>site</span>, <span class='fl'>1</span><span class='op'>:</span><span class='va'>nReps</span><span class='op'>]</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/pkg/nimbleEcology/man/dOcc.html'>dOcc_v</a></span><span class='op'>(</span>
      probOcc <span class='op'>=</span> <span class='va'>psi</span><span class='op'>[</span><span class='va'>site</span><span class='op'>]</span>, 
      probDetect <span class='op'>=</span> <span class='va'>p</span><span class='op'>[</span><span class='va'>site</span>, <span class='fl'>1</span><span class='op'>:</span><span class='va'>nReps</span><span class='op'>]</span>,
      len <span class='op'>=</span> <span class='va'>nReps</span>
    <span class='op'>)</span>
    
    <span class='co'># We define a logit-linear relationship between </span>
    <span class='co'># inprod(x, y) is the same as x[1] * y[1] + x[2] * y[2] + ...</span>
    <span class='co'># Note that:</span>
    <span class='co'># - We can put logit() on the left-hand side like a model equation</span>
    <span class='co'># - The data intercept is represented in model matrix notation inside occuCovars</span>
    <span class='co'>#   (more on that in a second)</span>
    <span class='co'># - We need EXPLICIT INDEXING for our vectors (beta[1:nBeta], not just beta).</span>
    <span class='co'>#   This is an important difference between nimbleCode and base R</span>
    <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-math.html'>logit</a></span><span class='op'>(</span><span class='va'>psi</span><span class='op'>[</span><span class='va'>site</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-math.html'>inprod</a></span><span class='op'>(</span><span class='va'>occuCovars</span><span class='op'>[</span><span class='va'>site</span>, <span class='fl'>1</span><span class='op'>:</span><span class='va'>nBeta</span><span class='op'>]</span>, <span class='va'>beta</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>nBeta</span><span class='op'>]</span><span class='op'>)</span>
    
    <span class='co'># Loop over reps</span>
    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>rep</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nReps</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='co'># Do this again for each detection probability. Only difference is that</span>
      <span class='co'># p is now two-dimensional and detectionCovars is three-dimensional.</span>
      <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-math.html'>logit</a></span><span class='op'>(</span><span class='va'>p</span><span class='op'>[</span><span class='va'>site</span>, <span class='va'>rep</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-math.html'>inprod</a></span><span class='op'>(</span><span class='va'>detectionCovars</span><span class='op'>[</span><span class='va'>site</span>, <span class='va'>rep</span>, <span class='fl'>1</span><span class='op'>:</span><span class='va'>nGamma</span><span class='op'>]</span>,
                                    <span class='va'>gamma</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>nGamma</span><span class='op'>]</span><span class='op'>)</span>
    <span class='op'>}</span> <span class='co'># END reps loop</span>
  <span class='op'>}</span> <span class='co'># END site loop</span>
  
  <span class='co'># Priors. We need these in order to do MCMC sampling. I'm going to choose some</span>
  <span class='co'># arbitrary, mostly uninformative priors.</span>
  <span class='co'># Priors on each covariate on occupancy:</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nBeta</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>beta</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='fl'>0</span>, sd <span class='op'>=</span> <span class='fl'>2.5</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='co'># Priors on each covariate on detection:</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nGamma</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>gamma</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>dnorm</a></span><span class='op'>(</span><span class='fl'>0</span>, sd <span class='op'>=</span> <span class='fl'>2.5</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Some of this code might look unfamiliar to folks who have done Bayesian occupancy modeling before. I’ve gone out of my way to make things generalizable, using <code>inprod()</code> over, for example, <code>intercept + elev[i] * b1 + forest[i] * b2</code>. My motivation for doing this is that it’s super generalizable, and I’ll be able to add or remove covariates without making any changes to my code.</p>
<p>Note that because we’re using nimbleEcology, we’ve “marginalized over” the latent state <span class="math inline">\(z\)</span> and it’s not in the model. This is a good thing for a couple reasons: it reduces the amount of RAM needed, which can be important for large datasets; it slightly speeds up mixing time in some cases; and it saves some lines of code. However, there are often cases where we <strong>want</strong> <span class="math inline">\(z\)</span>, such as if we want a posterior distribution on the number of occupied sites. In that case we shouldn’t use nimbleEcology (but NIMBLE will do fine).</p>
<p>The next step in the NIMBLE workflow is to define a NIMBLE model object. This turns our code, which describes a series of nodes and the relationships between them, into an actual object composed of that structure.</p>
<p>All the data wrangling I have to do is just to get my inputs in the same form as I’ve described them.</p>
<p>Because I’m using <code>inprod()</code> I need to make sure my data have intercept columns first.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>siteLevelData</span><span class='op'>$</span><span class='va'>intercept</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>obsLevelData</span><span class='op'>[</span>,, <span class='st'>"intercept"</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>occu_model</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimbleModel.html'>nimbleModel</a></span><span class='op'>(</span>
  code <span class='op'>=</span> <span class='va'>occuCode</span>,
  constants <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    nBeta <span class='op'>=</span> <span class='fl'>3</span>,
    nGamma <span class='op'>=</span> <span class='fl'>4</span>,
    nSites <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>)</span>,
    nReps <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>obs</span><span class='op'>)</span>
  <span class='op'>)</span>,
  data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    obs <span class='op'>=</span> <span class='va'>obs</span>,
    <span class='co'># I like indexing these here for two reasons: (1) I make sure they're going</span>
    <span class='co'>#   into the model in order, and (2) </span>
    detectionCovars <span class='op'>=</span> 
      <span class='va'>obsLevelData</span><span class='op'>[</span>,, <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-R-functions.html'>c</a></span><span class='op'>(</span><span class='st'>"intercept"</span>, <span class='st'>"elevation"</span>, <span class='st'>"forestCover"</span>, <span class='st'>"windLevel"</span><span class='op'>)</span><span class='op'>]</span>,
    occuCovars <span class='op'>=</span> <span class='va'>siteLevelData</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-R-functions.html'>c</a></span><span class='op'>(</span><span class='st'>"intercept"</span>, <span class='st'>"elevation"</span>, <span class='st'>"forestCover"</span><span class='op'>)</span><span class='op'>]</span>
  <span class='op'>)</span>,
  inits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    beta <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>,
    gamma <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>4</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>That’s it! We now have a nimbleModel object.</p>
<p>One of my favorite things about working in NIMBLE is that we can play with and query the nimbleModel.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Peek inside the model: what are the data values for the 22nd site?</span>
<span class='va'>occu_model</span><span class='op'>$</span><span class='va'>obs</span><span class='op'>[</span><span class='fl'>22</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 0 0 0</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># What's the corresponding site-level data at this site?</span>
<span class='va'>occu_model</span><span class='op'>$</span><span class='va'>occuCovars</span><span class='op'>[</span><span class='fl'>22</span>,<span class='op'>]</span> <span class='co'># Intercept, elevation, tree cover</span>
</code></pre>
</div>
<pre><code>[1]  1.0000000  0.2463764 -0.1503483</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># What's the log-likelihood of the model given initial values?</span>
<span class='co'># (If this is non-NA, that means our model is initialized properly)</span>
<span class='va'>occu_model</span><span class='op'>$</span><span class='fu'>calculate</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] -303.6887</code></pre>
</div>
<p>If we wanted to, we could modify data or initial values at this stage, but not constants, which are “baked in” to the model when its built.</p>
<p>I’ll go quickly over this next part, since using MCMC with NIMBLE is better explained elsewhere. Briefly, we’re going to build an MCMC object and then compile the whole thing so we’re ready to do some MCMC sampling.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>mcmc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/buildMCMC.html'>buildMCMC</a></span><span class='op'>(</span><span class='va'>occu_model</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>===== Monitors =====
thin = 1: beta, gamma
===== Samplers =====
RW sampler (7)
  - beta[]  (3 elements)
  - gamma[]  (4 elements)</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Compile to C++. This takes a second, but it's worth it!</span>
<span class='va'>complist</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/compileNimble.html'>compileNimble</a></span><span class='op'>(</span><span class='va'>occu_model</span>, <span class='va'>mcmc</span><span class='op'>)</span>

<span class='co'># We can still query / modify the compiled model</span>
<span class='va'>complist</span><span class='op'>$</span><span class='va'>occu_model</span><span class='op'>$</span><span class='va'>obs</span><span class='op'>[</span><span class='fl'>22</span>,<span class='op'>]</span>
</code></pre>
</div>
<pre><code>[1] 0 0 0</code></pre>
</div>
<p>Now let’s do some MCMC sampling. 10,000 MCMC samples on 2 chains is a bit overkill for this model, but it’s quick–this takes about 20 seconds to run on my machine.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>samples</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/runMCMC.html'>runMCMC</a></span><span class='op'>(</span><span class='va'>complist</span><span class='op'>$</span><span class='va'>mcmc</span>, 
                   niter <span class='op'>=</span> <span class='fl'>10000</span>,
                   nburnin <span class='op'>=</span> <span class='fl'>1000</span>,
                   nchains <span class='op'>=</span> <span class='fl'>2</span>,
                   thin <span class='op'>=</span> <span class='fl'>1</span>,
                   samplesAsCodaMCMC <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>|-------------|-------------|-------------|-------------|
|-------------------------------------------------------|
|-------------|-------------|-------------|-------------|
|-------------------------------------------------------|</code></pre>
</div>
<p>We can plot some of our chains to see how they mixed, for example the logit-scale effect of elevation on occupancy, which is <code>beta[2]</code> (because <code>beta[1]</code> is the intercept).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>samples</span><span class='op'>[</span>, <span class='st'>"beta[2]"</span><span class='op'>]</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="intro-to-nimbleecology-site-occupancy-models_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<p>I like the package <code>MCMCvis</code> for MCMC summaries.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>summary</span> <span class='op'>&lt;-</span> <span class='fu'>MCMCvis</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MCMCvis/man/MCMCsummary.html'>MCMCsummary</a></span><span class='op'>(</span><span class='va'>samples</span><span class='op'>)</span>

<span class='va'>summary</span><span class='op'>$</span><span class='va'>param</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-R-functions.html'>c</a></span><span class='op'>(</span><span class='st'>"Intercept (occu)"</span>, <span class='st'>"Elev (occu)"</span>, <span class='st'>"Forest (occu)"</span>,
                   <span class='st'>"Intercept (det)"</span>, <span class='st'>"Elev (det)"</span>, <span class='st'>"Forest (det)"</span>, <span class='st'>"Wind (det)"</span><span class='op'>)</span>

<span class='va'>summary</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/pkg/nimble/man/nimble-R-functions.html'>c</a></span><span class='op'>(</span><span class='st'>"param"</span>, <span class='st'>"mean"</span>, <span class='st'>"2.5%"</span>, <span class='st'>"97.5%"</span><span class='op'>)</span><span class='op'>]</span>
</code></pre>
</div>
<pre><code>                    param        mean       2.5%       97.5%
beta[1]  Intercept (occu)  0.27558912 -0.3995926  1.42759930
beta[2]       Elev (occu)  0.87816447 -0.4128858  2.23862643
beta[3]     Forest (occu) -1.82784288 -3.4780877 -0.62010363
gamma[1]  Intercept (det) -0.81601934 -1.3094703 -0.35864626
gamma[2]       Elev (det)  0.50585592 -0.1835229  1.26530091
gamma[3]     Forest (det)  0.03689909 -0.7124781  0.69144787
gamma[4]       Wind (det) -0.50269720 -0.9427505 -0.07756671</code></pre>
</div>
<p>We found a negative effect of forest cover on occupancy, and a negative effect of wind speed on detection. Nice.</p>
<h1 id="next-time">Next time…</h1>
<p>Stay tuned for two follow up posts. In the first, I’ll discuss easy ways to extend the occupancy model in NIMBLE to showcase the flexibility of this tool. Then, I’ll showcase an N-mixture model, and we’ll explore a case where marginalizing over a latent state can dramatically improve computation time.</p>
<p>Thanks for reading! Hit the “contact me” button at the top of the page if you have any questions or feedback.</p>
<h1 id="citations-and-additional-reading">Citations and additional reading</h1>
<p>All the code in this exercise is available in the Github repository for this blog, specifically here. Please feel free to download and play around with this .Rmd file, and to copy and use this code freely.</p>
<p>Relevant papers and books:</p>
<ul>
<li><a href="doi.org/10.1890/0012-9658(2002)083%5B2248:ESORWD%5D2.0.CO;2">Original MacKenzie et al. 2002 paper</a> on site-occupancy model</li>
<li><a href="doi.org/10.1002/ece3.6053">Ponisio et al. 2020</a> paper marginalizing distributions in NIMBLE</li>
<li><a href="https://www.sciencedirect.com/book/9780124071971/occupancy-estimation-and-modeling">Occupancy Estimation and Modeling textbook</a> by MacKenzie et al.</li>
</ul>
<p>As always, check out the <a href="https://r-nimble.org/manuals/NimbleUserManual.pdf">NIMBLE User Manual</a> and the <a href="https://r-nimble.org/examples">NIMBLE examples page</a> for more NIMBLE stuff.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
